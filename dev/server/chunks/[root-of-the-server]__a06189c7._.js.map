{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/phuonghuupham/Documents/GitHub/Pathfinity/app/db/schema.ts"],"sourcesContent":["import {\n  boolean,\n  pgTable,\n  text,\n  timestamp,\n  serial,\n  vector,\n  index,\n  jsonb,\n} from \"drizzle-orm/pg-core\";\n\n/* User / Auth */\nexport const user = pgTable(\"users\", {\n  id: text(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull().unique(), \n  emailVerified: boolean(\"email_verified\"),\n  image: text(\"image\"),\n  password: text(\"password\"), // Add password field for email authentication\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const session = pgTable(\"sessions\", {\n  id: text(\"id\").primaryKey(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  token: text(\"token\").notNull().unique(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  ipAddress: text(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n});\n\nexport const account = pgTable(\"accounts\", {\n  id: text(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n  accountId: text(\"account_id\").notNull(),\n  providerId: text(\"provider_id\").notNull(),\n  accessToken: text(\"access_token\"),\n  refreshToken: text(\"refresh_token\"),\n  accessTokenExpiresAt: timestamp(\"access_token_expires_at\"),\n  refreshTokenExpiresAt: timestamp(\"refresh_token_expires_at\"),\n  scope: text(\"scope\"),\n  idToken: text(\"id_token\"),\n  password: text(\"password\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const verification = pgTable(\"verifications\", {\n  id: text(\"id\").primaryKey(),\n  identifier: text(\"identifier\").notNull(),\n  value: text(\"value\").notNull(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").notNull(),\n});\n\n/* RAG (Retrieval-Augmented Generation) tables */\n\n// Sources represent the origin of documents (files, URLs, datasets)\nexport const source = pgTable(\"sources\", {\n  id: text(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  url: text(\"url\"),\n  type: text(\"type\").notNull(), // e.g. 'json-file', 'api'\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Embeddings: store only the embeddings and minimal metadata, linked to a source.\nexport const embedding = pgTable(\"embeddings\", {\n  id: serial(\"id\").primaryKey(),\n  sourceId: text(\"source_id\").notNull().references(() => source.id, { onDelete: \"cascade\" }),\n  refId: text(\"ref_id\"),              // record ID in source (e.g., courseCode)\n  title: text(\"title\"),               // human-readable title\n  campus: text(\"campus\"),             // optional display info\n  courseCode: text(\"course_code\"),    // optional for courses\n  content: text(\"content\"),           // the text used to create embedding\n  metadata: jsonb(\"metadata\"),        // store the full original object\n  contentHash: text(\"content_hash\"),  // optional deduplication\n  embedding: vector(\"embedding\", { dimensions: 1536 }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  },\n  (table) => [\n    index(\"embedding_vector_idx\").using(\"ivfflat\", table.embedding.op(\"vector_cosine_ops\")),\n  ]\n);"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///Users/phuonghuupham/Documents/GitHub/Pathfinity/app/db/index.ts"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-http';\nimport { config } from 'dotenv';\n\nimport * as schema from './schema';\n\nconfig({ path: '.env' });\n\nconst sql = neon(process.env.DATABASE_URL as string);\nexport const db = drizzle(sql, { schema });"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAEA;;;;;AAEA,IAAA,iJAAM,EAAC;IAAE,MAAM;AAAO;AAEtB,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAClC,MAAM,KAAK,IAAA,qKAAO,EAAC,KAAK;IAAE,QAAA;AAAO","debugId":null}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///Users/phuonghuupham/Documents/GitHub/Pathfinity/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\";\nimport { drizzleAdapter } from \"better-auth/adapters/drizzle\";\nimport { db } from \"@/app/db\";\nimport * as schema from \"@/app/db/schema\";\nimport crypto from \"crypto\";\nimport { eq } from \"drizzle-orm\";\n\n// Function to generate a secure random password\nfunction generateSecurePassword(length: number = 16): string {\n  const charset = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*\";\n  let password = \"\";\n  for (let i = 0; i < length; i++) {\n    password += charset.charAt(crypto.randomInt(0, charset.length));\n  }\n  return password;\n}\n\nexport const auth = betterAuth({\n  database: drizzleAdapter(db, {\n    provider: \"pg\",\n    schema: {\n      user: schema.user,\n      session: schema.session,\n      account: schema.account,\n      verification: schema.verification,\n    },\n  }),\n  secret: process.env.BETTER_AUTH_SECRET || \"fallback-secret-for-development\",\n  pages : {\n    signIn: '/login',\n  },\n  emailAndPassword: {\n    enabled: true,\n    requireEmailVerification: false,\n  },\n  socialProviders: {\n        github: { \n            clientId: process.env.GITHUB_CLIENT_ID as string, \n            clientSecret: process.env.GITHUB_CLIENT_SECRET as string, \n        }, \n        google: { \n            clientId: process.env.GOOGLE_CLIENT_ID as string, \n            clientSecret: process.env.GOOGLE_CLIENT_SECRET as string, \n        },\n    },\n  events: {\n    user: {\n      created: async (user: { id: string; email: string; password?: string }) => {\n        // Only run for OAuth users (no password) and when email exists\n        if (!user.password && user.email) {\n          try {\n            // Check if another user with this email already exists\n            const existingUser = await db.query.user.findFirst({\n              where: eq(schema.user.email, user.email),\n              columns: { id: true, email: true, password: true, name: true, image: true, emailVerified: true }\n            });\n\n            // If we found another user with the same email (not the one just created)\n            if (existingUser && existingUser.id !== user.id) {\n              console.log(`Found existing user with email ${user.email}. Linking accounts...`);\n              \n              // Move the account from the new user to the existing user\n              await db.update(schema.account)\n                .set({ userId: existingUser.id })\n                .where(eq(schema.account.userId, user.id));\n\n              // Move any sessions from the new user to the existing user\n              await db.update(schema.session)\n                .set({ userId: existingUser.id })\n                .where(eq(schema.session.userId, user.id));\n\n              // Update existing user with OAuth info if missing\n              const updateData: Partial<typeof schema.user.$inferInsert> = {};\n              if (!existingUser.image && user.id) {\n                // Get the new user's image from the database\n                const newUserData = await db.query.user.findFirst({\n                  where: eq(schema.user.id, user.id),\n                  columns: { image: true }\n                });\n                if (newUserData?.image) {\n                  updateData.image = newUserData.image;\n                }\n              }\n              if (!existingUser.emailVerified) {\n                updateData.emailVerified = true;\n              }\n              \n              if (Object.keys(updateData).length > 0) {\n                await db.update(schema.user)\n                  .set(updateData)\n                  .where(eq(schema.user.id, existingUser.id));\n              }\n\n              // If existing user doesn't have a password, generate one\n              if (!existingUser.password) {\n                const randomPassword = generateSecurePassword();\n                const bcrypt = await import('bcryptjs');\n                const hashedPassword = await bcrypt.hash(randomPassword, 12);\n                \n                await db.update(schema.user)\n                  .set({ password: hashedPassword })\n                  .where(eq(schema.user.id, existingUser.id));\n              }\n\n              // Delete the duplicate user that was just created\n              await db.delete(schema.user)\n                .where(eq(schema.user.id, user.id));\n\n              console.log(`Successfully linked OAuth account to existing user: ${existingUser.email}`);\n              return; // Exit early since we've handled the linking\n            }\n\n            // If no existing user found, this is a new OAuth user - generate password\n            const randomPassword = generateSecurePassword();\n            const bcrypt = await import('bcryptjs');\n            const hashedPassword = await bcrypt.hash(randomPassword, 12);\n            \n            await db.update(schema.user)\n              .set({ password: hashedPassword })\n              .where(eq(schema.user.id, user.id));\n            \n            console.log(`Generated password for new OAuth user: ${user.email}`);\n          } catch (error) {\n            console.error(\"Error handling OAuth user creation:\", error);\n          }\n        }\n      },\n    },\n  },\n});\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 320, "column": 0}, "map": {"version":3,"sources":["file:///Users/phuonghuupham/Documents/GitHub/Pathfinity/app/api/auth/%5B...all%5D/route.ts"],"sourcesContent":["import { auth } from \"@/lib/auth\";\nimport { toNextJsHandler } from \"better-auth/next-js\";\n\nexport const { GET, POST } = toNextJsHandler(auth.handler);\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,IAAA,0LAAe,EAAC,qHAAI,CAAC,OAAO","debugId":null}}]
}