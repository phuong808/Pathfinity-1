{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/phuonghuupham/Documents/GitHub/Pathfinity/src/db/schema.ts"],"sourcesContent":["import { boolean, pgTable, text,  timestamp } from \"drizzle-orm/pg-core\";\n\nexport const user = pgTable(\"users\", {\n  id: text(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull().unique(), \n  emailVerified: boolean(\"email_verified\"),\n  image: text(\"image\"),\n  password: text(\"password\"), // Add password field for email authentication\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const session = pgTable(\"sessions\", {\n  id: text(\"id\").primaryKey(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  token: text(\"token\").notNull().unique(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  ipAddress: text(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n});\n\nexport const account = pgTable(\"accounts\", {\n  id: text(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n  accountId: text(\"account_id\").notNull(),\n  providerId: text(\"provider_id\").notNull(),\n  accessToken: text(\"access_token\"),\n  refreshToken: text(\"refresh_token\"),\n  accessTokenExpiresAt: timestamp(\"access_token_expires_at\"),\n  refreshTokenExpiresAt: timestamp(\"refresh_token_expires_at\"),\n  scope: text(\"scope\"),\n  idToken: text(\"id_token\"),\n  password: text(\"password\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const verification = pgTable(\"verifications\", {\n  id: text(\"id\").primaryKey(),\n  identifier: text(\"identifier\").notNull(),\n  value: text(\"value\").notNull(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").notNull(),\n});"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;;AAEO,MAAM,OAAO,IAAA,kKAAO,EAAC,SAAS;IACnC,IAAI,IAAA,yKAAI,EAAC,MAAM,UAAU;IACzB,MAAM,IAAA,yKAAI,EAAC,QAAQ,OAAO;IAC1B,OAAO,IAAA,yKAAI,EAAC,SAAS,OAAO,GAAG,MAAM;IACrC,eAAe,IAAA,+KAAO,EAAC;IACvB,OAAO,IAAA,yKAAI,EAAC;IACZ,UAAU,IAAA,yKAAI,EAAC;IACf,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU,GAAG,OAAO;IACvD,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU,GAAG,OAAO;AACzD;AAEO,MAAM,UAAU,IAAA,kKAAO,EAAC,YAAY;IACzC,IAAI,IAAA,yKAAI,EAAC,MAAM,UAAU;IACzB,WAAW,IAAA,mLAAS,EAAC,cAAc,OAAO;IAC1C,OAAO,IAAA,yKAAI,EAAC,SAAS,OAAO,GAAG,MAAM;IACrC,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU,GAAG,OAAO;IACvD,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU,GAAG,OAAO;IACvD,WAAW,IAAA,yKAAI,EAAC;IAChB,WAAW,IAAA,yKAAI,EAAC;IAChB,QAAQ,IAAA,yKAAI,EAAC,WAAW,OAAO,GAAG,UAAU,CAAC,IAAM,KAAK,EAAE,EAAE;QAAE,UAAU;IAAU;AACpF;AAEO,MAAM,UAAU,IAAA,kKAAO,EAAC,YAAY;IACzC,IAAI,IAAA,yKAAI,EAAC,MAAM,UAAU;IACzB,QAAQ,IAAA,yKAAI,EAAC,WAAW,OAAO,GAAG,UAAU,CAAC,IAAM,KAAK,EAAE,EAAE;QAAE,UAAU;IAAU;IAClF,WAAW,IAAA,yKAAI,EAAC,cAAc,OAAO;IACrC,YAAY,IAAA,yKAAI,EAAC,eAAe,OAAO;IACvC,aAAa,IAAA,yKAAI,EAAC;IAClB,cAAc,IAAA,yKAAI,EAAC;IACnB,sBAAsB,IAAA,mLAAS,EAAC;IAChC,uBAAuB,IAAA,mLAAS,EAAC;IACjC,OAAO,IAAA,yKAAI,EAAC;IACZ,SAAS,IAAA,yKAAI,EAAC;IACd,UAAU,IAAA,yKAAI,EAAC;IACf,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU,GAAG,OAAO;IACvD,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU,GAAG,OAAO;AACzD;AAEO,MAAM,eAAe,IAAA,kKAAO,EAAC,iBAAiB;IACnD,IAAI,IAAA,yKAAI,EAAC,MAAM,UAAU;IACzB,YAAY,IAAA,yKAAI,EAAC,cAAc,OAAO;IACtC,OAAO,IAAA,yKAAI,EAAC,SAAS,OAAO;IAC5B,WAAW,IAAA,mLAAS,EAAC,cAAc,OAAO;IAC1C,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU,GAAG,OAAO;IACvD,WAAW,IAAA,mLAAS,EAAC,cAAc,OAAO;AAC5C","debugId":null}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/phuonghuupham/Documents/GitHub/Pathfinity/src/db/index.ts"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-http';\n\nimport * as schema from './schema';\n\nconst sql = neon(process.env.DATABASE_URL as string);\nexport const db = drizzle(sql, { schema });"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;;;;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAClC,MAAM,KAAK,IAAA,qKAAO,EAAC,KAAK;IAAE,QAAA;AAAO","debugId":null}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///Users/phuonghuupham/Documents/GitHub/Pathfinity/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n// Password validation types and utilities\nexport interface PasswordRequirement {\n  id: string;\n  label: string;\n  test: (password: string) => boolean;\n}\n\nexport const passwordRequirements: PasswordRequirement[] = [\n  {\n    id: 'length',\n    label: 'Between 8-12 characters',\n    test: (password: string) => password.length >= 8 && password.length <= 12,\n  },\n  {\n    id: 'uppercase',\n    label: 'At least one uppercase letter (A-Z)',\n    test: (password: string) => /[A-Z]/.test(password),\n  },\n  {\n    id: 'number',\n    label: 'At least one number (0-9)',\n    test: (password: string) => /[0-9]/.test(password),\n  },\n  {\n    id: 'special',\n    label: 'At least one special character (!@#$%^&*()-_=+)',\n    test: (password: string) => /[!@#$%^&*()\\-_=+]/.test(password),\n  },\n  {\n    id: 'noSpaces',\n    label: 'No spaces allowed',\n    test: (password: string) => !/\\s/.test(password),\n  },\n];\n\nexport function validatePassword(password: string): {\n  isValid: boolean;\n  failedRequirements: PasswordRequirement[];\n  passedRequirements: PasswordRequirement[];\n} {\n  const failedRequirements = passwordRequirements.filter(req => !req.test(password));\n  const passedRequirements = passwordRequirements.filter(req => req.test(password));\n  \n  return {\n    isValid: failedRequirements.length === 0,\n    failedRequirements,\n    passedRequirements,\n  };\n}\n\nexport function getPasswordStrengthMessage(password: string): string {\n  const validation = validatePassword(password);\n  \n  if (validation.isValid) {\n    // return 'Password meets all requirements';\n    return '';\n  }\n  \n  if (validation.failedRequirements.length === passwordRequirements.length) {\n    // return 'Password does not meet any requirements';\n    return '';\n  }\n  \n  return `Password missing: ${validation.failedRequirements.map(req => req.label.toLowerCase()).join(', ')}`;\n}\n\n// Email verification utilities\nexport function generateVerificationCode(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString();\n}\n\nexport async function sendVerificationEmail(email: string, code: string): Promise<boolean> {\n  try {\n    console.log('üîç Attempting to send email...');\n    console.log('Email:', email);\n    console.log('Code:', code);\n    console.log('API Key exists:', !!process.env.RESEND_API_KEY);\n    console.log('API Key starts with re_:', process.env.RESEND_API_KEY?.startsWith('re_'));\n    \n    // Check if we have a Resend API key\n    if (process.env.RESEND_API_KEY && process.env.RESEND_API_KEY !== 'your_resend_api_key_here') {\n      console.log('üöÄ Using Resend to send email...');\n      \n      try {\n        // Use Resend for actual email sending\n        const { Resend } = await import('resend');\n        const resend = new Resend(process.env.RESEND_API_KEY);\n        \n        // List of verified emails that can receive test emails\n        const verifiedTestEmails = ['phuong9@hawaii.edu'];\n        const isTestEmail = verifiedTestEmails.includes(email);\n        \n        if (!isTestEmail) {\n          console.log('‚ö†Ô∏è  Email not in verified test list. Using development mode for:', email);\n          console.log('üìß To send real emails, verify a domain at https://resend.com/domains');\n          console.log('‚úÖ Verified test emails:', verifiedTestEmails.join(', '));\n          \n          // Use development mode for non-verified emails\n          console.log(`\\n=== EMAIL VERIFICATION (DEV MODE) ===`);\n          console.log(`To: ${email}`);\n          console.log(`Verification Code: ${code}`);\n          console.log(`‚ö†Ô∏è  Using dev mode - add ${email} to verified list or verify domain`);\n          console.log(`=====================================\\n`);\n          return true;\n        }\n        \n        console.log('üìß Sending email via Resend to verified email...');\n        const result = await resend.emails.send({\n          from: 'Pathfinity <delivered@resend.dev>', // Use Resend's verified test domain\n          to: email,\n          subject: 'Verify your email address - Pathfinity',\n          html: `\n            <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n              <h2 style=\"color: #2563eb; margin-bottom: 20px;\">Verify your email address</h2>\n              <p style=\"margin-bottom: 20px;\">Thank you for signing up for Pathfinity! Please use the verification code below to complete your registration:</p>\n              \n              <div style=\"background: #f3f4f6; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0;\">\n                <h1 style=\"color: #2563eb; font-size: 32px; letter-spacing: 4px; margin: 0;\">${code}</h1>\n              </div>\n              \n              <p style=\"margin-bottom: 20px;\">This code will expire in 15 minutes for security reasons.</p>\n              <p style=\"color: #6b7280; font-size: 14px;\">If you didn't request this verification, please ignore this email.</p>\n              \n              <hr style=\"margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;\">\n              <p style=\"color: #6b7280; font-size: 12px; margin: 0;\">\n                This email was sent by Pathfinity. If you have any questions, please contact our support team.\n              </p>\n            </div>\n          `,\n        });\n\n        console.log('üì¨ Resend result:', result);\n\n        if (result.error) {\n          console.error('‚ùå Resend error:', result.error);\n          \n          // Check if it's a domain verification issue\n          if (result.error.message && result.error.message.includes('testing emails')) {\n            console.log('‚ö†Ô∏è  Resend API is in test mode - emails can only be sent to verified addresses');\n            console.log('üìß For testing, try using: phuong9@hawaii.edu');\n            console.log('üîß To send to any email, verify a domain at https://resend.com/domains');\n          }\n          \n          // Fallback to dev mode if Resend fails\n          console.log('üîÑ Falling back to development mode...');\n          console.log(`\\n=== EMAIL VERIFICATION (FALLBACK MODE) ===`);\n          console.log(`To: ${email}`);\n          console.log(`Verification Code: ${code}`);\n          console.log(`‚ö†Ô∏è  Resend API failed, using dev mode fallback`);\n          console.log(`=====================================\\n`);\n          return true;\n        }\n\n        console.log(`‚úÖ Verification email sent successfully to ${email} via Resend`);\n        console.log('Email ID:', result.data?.id);\n        return true;\n      } catch (resendError) {\n        console.error('‚ùå Resend API error:', resendError);\n        // Fallback to dev mode if Resend fails\n        console.log('üîÑ Falling back to development mode...');\n        console.log(`\\n=== EMAIL VERIFICATION (FALLBACK MODE) ===`);\n        console.log(`To: ${email}`);\n        console.log(`Verification Code: ${code}`);\n        console.log(`‚ö†Ô∏è  Resend API failed, using dev mode fallback`);\n        console.log(`=====================================\\n`);\n        return true;\n      }\n    } else {\n      // Fallback to console logging for development\n      console.log(`\\n=== EMAIL VERIFICATION (DEV MODE) ===`);\n      console.log(`To: ${email}`);\n      console.log(`Verification Code: ${code}`);\n      console.log(`‚ö†Ô∏è  To send real emails, add your RESEND_API_KEY to .env.local`);\n      console.log(`=====================================\\n`);\n      \n      return true; // For development\n    }\n  } catch (error) {\n    console.error('üí• Error sending verification email:', error);\n    console.error('Error details:', error);\n    // Still return true for development/testing\n    console.log('üîÑ Using dev mode fallback due to error...');\n    console.log(`\\n=== EMAIL VERIFICATION (ERROR FALLBACK) ===`);\n    console.log(`To: ${email}`);\n    console.log(`Verification Code: ${code}`);\n    console.log(`‚ö†Ô∏è  Error occurred, using dev mode fallback`);\n    console.log(`=====================================\\n`);\n    return true;\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///Users/phuonghuupham/Documents/GitHub/Pathfinity/app/api/auth/send-verification/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { db } from '@/src/db';\nimport * as schema from '@/src/db/schema';\nimport { eq } from 'drizzle-orm';\nimport { generateVerificationCode, sendVerificationEmail } from '@/lib/utils';\nimport crypto from 'crypto';\n\nexport async function POST(request: NextRequest) {\n  let email = '';\n  try {\n    const { email: requestEmail } = await request.json();\n    email = requestEmail;\n\n    if (!email) {\n      return NextResponse.json(\n        { error: 'Email is required' },\n        { status: 400 }\n      );\n    }\n\n    // Check if user exists\n    const existingUser = await db.query.user.findFirst({\n      where: eq(schema.user.email, email),\n    });\n\n    if (existingUser) {\n      return NextResponse.json(\n        { error: 'An account with this email already exists. Please try signing in instead.' },\n        { status: 400 }\n      );\n    }\n\n    // Clean up any existing verification records for this email\n    await db.delete(schema.verification)\n      .where(eq(schema.verification.identifier, email));\n\n    // Generate verification code\n    const code = generateVerificationCode();\n    const expiresAt = new Date(Date.now() + 15 * 60 * 1000); // 15 minutes\n\n    // Store verification code in database\n    await db.insert(schema.verification).values({\n      id: crypto.randomUUID(),\n      identifier: email,\n      value: code,\n      expiresAt,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    });\n\n    // Send verification email\n    const emailSent = await sendVerificationEmail(email, code);\n\n    if (!emailSent) {\n      return NextResponse.json(\n        { error: 'Failed to send verification email' },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      message: 'Verification code sent successfully',\n      success: true,\n    });\n\n  } catch (error) {\n    console.error('Error sending verification code:', error);\n    console.error('Error details:', {\n      message: error instanceof Error ? error.message : 'Unknown error',\n      stack: error instanceof Error ? error.stack : undefined,\n      email: email\n    });\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI,QAAQ;IACZ,IAAI;QACF,MAAM,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,QAAQ,IAAI;QAClD,QAAQ;QAER,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,uBAAuB;QACvB,MAAM,eAAe,MAAM,0HAAE,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC;YACjD,OAAO,IAAA,0KAAE,EAAC,6HAAW,CAAC,KAAK,EAAE;QAC/B;QAEA,IAAI,cAAc;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4E,GACrF;gBAAE,QAAQ;YAAI;QAElB;QAEA,4DAA4D;QAC5D,MAAM,0HAAE,CAAC,MAAM,CAAC,qIAAmB,EAChC,KAAK,CAAC,IAAA,0KAAE,EAAC,qIAAmB,CAAC,UAAU,EAAE;QAE5C,6BAA6B;QAC7B,MAAM,OAAO,IAAA,0IAAwB;QACrC,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,OAAO,aAAa;QAEtE,sCAAsC;QACtC,MAAM,0HAAE,CAAC,MAAM,CAAC,qIAAmB,EAAE,MAAM,CAAC;YAC1C,IAAI,gHAAM,CAAC,UAAU;YACrB,YAAY;YACZ,OAAO;YACP;YACA,WAAW,IAAI;YACf,WAAW,IAAI;QACjB;QAEA,0BAA0B;QAC1B,MAAM,YAAY,MAAM,IAAA,uIAAqB,EAAC,OAAO;QAErD,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,QAAQ,KAAK,CAAC,kBAAkB;YAC9B,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAClD,OAAO,iBAAiB,QAAQ,MAAM,KAAK,GAAG;YAC9C,OAAO;QACT;QACA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}